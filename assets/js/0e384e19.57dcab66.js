"use strict";(self.webpackChunkdocs_borealisdb_io=self.webpackChunkdocs_borealisdb_io||[]).push([[671],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>h});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),u=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},c=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,l=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=u(r),m=a,h=p["".concat(s,".").concat(m)]||p[m]||d[m]||l;return r?n.createElement(h,o(o({ref:t},c),{},{components:r})):n.createElement(h,o({ref:t},c))}));function h(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=r.length,o=new Array(l);o[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[p]="string"==typeof e?e:a,o[1]=i;for(var u=2;u<l;u++)o[u]=r[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},9881:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>i,toc:()=>u});var n=r(7462),a=(r(7294),r(3905));const l={sidebar_position:1},o="Getting started",i={unversionedId:"intro",id:"intro",title:"Getting started",description:"Pre-requisites",source:"@site/docs/intro.md",sourceDirName:".",slug:"/intro",permalink:"/docs/intro",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/intro.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",next:{title:"Operator",permalink:"/docs/category/operator"}},s={},u=[{value:"Pre-requisites",id:"pre-requisites",level:3},{value:"Borealis CLI",id:"borealis-cli",level:2},{value:"Download and install",id:"download-and-install",level:3},{value:"Initialize the cli",id:"initialize-the-cli",level:3},{value:"Create a new project",id:"create-a-new-project",level:2},{value:"Configure your new project",id:"configure-your-new-project",level:3},{value:"Deploy the infrastructures",id:"deploy-the-infrastructures",level:2},{value:"Login with the CLI",id:"login-with-the-cli",level:2},{value:"Deploy the cluster",id:"deploy-the-cluster",level:2},{value:"Connect to the cluster",id:"connect-to-the-cluster",level:2}],c={toc:u},p="wrapper";function d(e){let{components:t,...r}=e;return(0,a.kt)(p,(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"getting-started"},"Getting started"),(0,a.kt)("h3",{id:"pre-requisites"},"Pre-requisites"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Helm ",(0,a.kt)("inlineCode",{parentName:"li"},"v3.8.0")),(0,a.kt)("li",{parentName:"ul"},"A kubernetes cluster with an ingress (Ex: nginx-ingress) deployed and TLS, metrics-server is optional but recommended"),(0,a.kt)("li",{parentName:"ul"},"An IDP provider with SSO OIDC (Ex: Auth0)")),(0,a.kt)("h2",{id:"borealis-cli"},"Borealis CLI"),(0,a.kt)("p",null,"To use borealisdb you don't need the CLI, but it will help to get you up and running quicker."),(0,a.kt)("h3",{id:"download-and-install"},"Download and install"),(0,a.kt)("p",null,"You can find all the cli binaries here: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/borealisdb/cli/releases"},"https://github.com/borealisdb/cli/releases")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"wget -qO- https://github.com/borealisdb/cli/releases/download/v0.0.7/borealisdb_0.0.7_linux_x86_64.tar.gz | sudo tar -xvz -C /usr/local/bin/ borealisdb\n")),(0,a.kt)("p",null,"Check that the cli has been installed correctly"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ borealisdb\nBorealis CLI: v0.0.7\n")),(0,a.kt)("h3",{id:"initialize-the-cli"},"Initialize the cli"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"borealisdb init --host <https://yourhost>\n")),(0,a.kt)("p",null,"this command will download the latest helm chart needed for the deployment, you can find the charts\nhere: ",(0,a.kt)("a",{parentName:"p",href:"https://borealisdb.github.io/charts/"},"https://borealisdb.github.io/charts/"),",\nand create a config folder in your home directory ",(0,a.kt)("inlineCode",{parentName:"p"},"$HOME/.borealis")," with the following files:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"config.ini")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"credentials.ini"))),(0,a.kt)("p",null,"for now there is no need to modify them"),(0,a.kt)("h2",{id:"create-a-new-project"},"Create a new project"),(0,a.kt)("p",null,"When you create a project the cli will scaffold the following directory structure:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"borealis/\n\u251c\u2500\u2500 development/\n\u2502   \u251c\u2500\u2500 your-cluster-name/\n\u2502   \u2502   \u251c\u2500\u2500 accounts.yaml\n\u2502   \u2502   \u251c\u2500\u2500 cluster.yaml\n\u2502   \u2502   \u2514\u2500\u2500 secrets.yaml\n\u2502   \u2514\u2500\u2500 infrastructures\n\u2502       \u251c\u2500\u2500 secrets.yaml\n\u2502       \u2514\u2500\u2500 values.yaml\n\u2514\u2500\u2500 production/\n    \u251c\u2500\u2500 your-cluster-name/\n    \u2502   \u251c\u2500\u2500 accounts.yaml\n    \u2502   \u251c\u2500\u2500 cluster.yaml\n    \u2502   \u2514\u2500\u2500 secrets.yaml\n    \u2514\u2500\u2500 infrastructures/\n        \u251c\u2500\u2500 secrets.yaml\n        \u2514\u2500\u2500 values.yaml\n")),(0,a.kt)("p",null,"Create the project:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"borealisdb create --cluster-name <your cluster> --host <https://yourhost>\n")),(0,a.kt)("h3",{id:"configure-your-new-project"},"Configure your new project"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"You need to fill your infrastructures secrets located in ",(0,a.kt)("inlineCode",{parentName:"p"},"borealis/<environment>/infrastructures"),":"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: Secret\nmetadata:\n  name: borealis-secrets\ntype: Opaque\ndata:\n  oidcProviderID: "" # All your IDP SSO configuration\n  oidcProviderName: ""\n  oidcProviderClientID: ""\n  oidcProviderClientSecret: ""\n  oidcProviderClientIssuerUrl: ""\n  clientSecret: "" # This is needed for the identity broker, you can auto-generate one yourself\n  clusterTokenSecret: "" # This the secret needed to encrypt cluster tokens, you can as well generate one yourself\n')))),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Borealisdb uses native Kubernetes secrets which are not securely encrypted.\nWe suggest you use something like ",(0,a.kt)("a",{parentName:"p",href:"https://external-secrets.io/v0.8.1/"},"External secrets operator"),", or others.\nIf you don't want to use any third party solution you should configure a strict RBAC rules for this resource.")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"For your IDP you need to whitelist the following callback: ",(0,a.kt)("inlineCode",{parentName:"p"},"https://<yourhost>/borealis/identity/callback"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Add your email to ",(0,a.kt)("inlineCode",{parentName:"p"},"accounts.yaml")," in ",(0,a.kt)("inlineCode",{parentName:"p"},"borealis/<environment>/<your cluster name>"),"; it should be the email belonging to your IDP"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"  apiVersion: borealisdb.io/v1\n  kind: BorealisClusterAccount\n  metadata:\n    name: <your-cluster-name>-accounts\n    labels:\n      clusterName: <your-cluster-name>\n  spec:\n  accounts:\n    - email: <your-email@company.com>\n      role: admin\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"BorealisClusterAccount")," is a CRD that helps you manage permissions and role associations in the cluster, adding your email to the admin\nrole will grant you access to the cluster")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"In the ",(0,a.kt)("inlineCode",{parentName:"p"},"values.yaml"),", change your storage class name if you are not using the ",(0,a.kt)("inlineCode",{parentName:"p"},"standard")," one"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"storage:\n  storageClassName: gp2 # Check the name from your provider\n")),(0,a.kt)("p",{parentName:"li"},"The full configuration ",(0,a.kt)("inlineCode",{parentName:"p"},"values.yaml")," can be found ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/borealisdb/charts/blob/master/borealis/values.yaml"},"here")))),(0,a.kt)("p",null,"If you are just testing this is all you need to configure"),(0,a.kt)("h2",{id:"deploy-the-infrastructures"},"Deploy the infrastructures"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"borealisdb deploy --environment <env>\n")),(0,a.kt)("p",null,"This command will deploy the borealis infrastructures and the borealis operator, if enabled (true by default) the default backup system."),(0,a.kt)("h2",{id:"login-with-the-cli"},"Login with the CLI"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"borealisdb login\n")),(0,a.kt)("p",null,"This will get a token in which will give you access to the borealisdb API and cluster"),(0,a.kt)("h2",{id:"deploy-the-cluster"},"Deploy the cluster"),(0,a.kt)("p",null,"Now you are ready to deploy the PostgreSQL cluster:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"borealisdb cluster deploy --cluster-name <yourcluster> --environment <env>\n")),(0,a.kt)("h2",{id:"connect-to-the-cluster"},"Connect to the cluster"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"borealisdb cluster connect --cluster-name <yourcluster> --userrole admin\n")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"In order to run this command successfully you need to first be login with the cli: ",(0,a.kt)("inlineCode",{parentName:"p"},"borealisdb login"))),(0,a.kt)("p",null,"This command will do a lot for you and you can do the same without the cli:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Download the cluster certificates: ",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get secrets <yourcluster>-tls -o 'jsonpath={.data.root\\.crt}' | base64 -d > root.crt\n"))),(0,a.kt)("li",{parentName:"ul"},"Get a cluster token",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"With the cli: ",(0,a.kt)("inlineCode",{parentName:"li"},"borealisdb cluster token --cluster-name <yourcluster>")),(0,a.kt)("li",{parentName:"ul"},"Via curl:",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"curl -X POST -H 'Authorization: Bearer ...'  https://<yourhost>/borealis/clusters/oauth2/token\n"))))),(0,a.kt)("li",{parentName:"ul"},"Port forward to the master (or replica) service:",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl port-forward <endpoint> 5432:5432 \n"))),(0,a.kt)("li",{parentName:"ul"},"Login with psql:",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'psql "sslmode=verify-ca sslrootcert=$HOME/.borealis/root.crt host=localhost user=admin port=5432 dbname=postgres"\n')))),(0,a.kt)("h1",{id:"explore-your-new-cluster"},"Explore your new cluster"),(0,a.kt)("p",null,"You can now login into the Borealis console, navigate to ",(0,a.kt)("inlineCode",{parentName:"p"},"https://<yourhost>/borealis/monitoring"),", it will redirect you to your IDP login\npage if you are not logged in yet.\nYou should see your cluster appearing in the cluster list, click on it to explore the metrics and logs.\nEnjoy!"))}d.isMDXComponent=!0}}]);